04 Енкапсулация
04 Encapsulation

# 1 Дефиниция Енкапсулация

* енкапсулацията e **скриване на методи или полета** 
* скритите атрибути (методи и полета) не могат да се достъпват извън класа

* три полезни неща на Енк:
  * контролираме какво да се достъпва (=да е видимо отвън)
  * може да валидираме стойностите, които се подават
    както и когато се достъпват
  * намаляваме сложността на атруибутите видими от потребителя

* концпепция на ООП
* един от 4/5 принципа на ООП
    * абстракция
    * наследяване
    * полиморфизъм
    * енкапсулация
    * exception handling

# 4 Скрити променливи (private varaibles)

* не може да достъпваме извън класа
* част от състоянието (state)
* с __

* в питон има 3 начина да контролираме достъпа,
  всички са конвенция на запис:
  * Public: name
  * Non-public: _age (като знак danger)
    * не се ползва много, осново при наследяване)
  * private / hidden (скрит атрибут): __age
    * могат да се достъпват в методите на класа

* в момента в който на self закача нещо с __ `__age`
то се прекръщава на `_Person__age` - това се казва Name magnling
* това са така наречените скрити атрибути (hidden / private attrs)
* Python го прекъщава чрез 2 метода на класа:
  `__setattr__ и __getattr__`
* При създаване в инит, се вика сетатр, при достъпване - гетатр (магически методи)

* __ атрибутите могат да се достъпват нормално 
във вътрешността на класа (по конкретно на методите му)
```python
def set_age(self, new_age):
    self.__age = new_age
```

# 2 Getters and Setters

* след създаване на обект не можем да четем или презаписваме скрити полета
* например да променим годините на човек или да ги прочетем
* затова ползваме специални методи; спец са
* методи, които създаваме сами; служат да даваме нова стойност на скрит атрибут 
  или да искаме стойността
* минавайки през тези методи е полезно за да валидираме стойността (напр години > 18)
* могат да се достъпват от потребителя чрез property-та

* private не е коректен терми в питон, hidden е правилният
* скрит атрибут (скрито поле) не може да се достъпва извън
класа, може да се достъпва само вътре в него. Това
  е идеята да скриваме атрибути. 
* правим методите да изглеждат като атрибути
* няма смисъл да правим само:
```python
    # setter - the pythonic way
    @name.setter
    def name(self, new_name):
        self.__name = new_name

    # getter - bad implementation
    def get_age(self):
        return self.__age
```
* сетърът в смислен за да сложим условие че 
стойността е валидна
* @property дава на метод фунцкионалността да се извика с instance.attr
* property се налича комплекта медоди @property и @attr.setter
* property (т.е. гетър) може да съществува самостоятелно (напр full_name)
* сетър (напр @city.setter) не може
```python
self = {Person} <__main__.Person object at 0x0657BCD0>
 MIN_AGE = {int} 18
 first_name = {str} 'P'
 full_name = {str} 'P Nikolov'
 last_name = {str} 'Nikolov'
  _Person__first_name = {str} 'Pesho'
```
* разликата между pesho.first_name = 'Pesho' като дата атрибут и като пропърти
е че при дата атрибут няма начин да проверим валидността на Името
и да върнем грешка
* По подобен начин при извикване print(pesho.first_name) с дата атрибут
клиента ще види пълното съхранено име, а чрез геттър метод на проперти 
може да изберем напр да види само първата буква: 'P.'
* т.е. това което клиента вижда И извиква ще е pesho.first_namе
а това което ние пазим в паметта (данните на обекта) може да е много
по-пълното и различно поле pesho._Person__first_name което е недостъпно
от клиента
* print(self.city) вика геттър с това име:
  ```python
  @property
  def city(self):
      return self.__city
  ``` 
* подаване на стойност self.city = 'Sofia' вика сетър със име city
  и създава скрит атрибут (с __) на инстанцията:
```python
@city.setter
def city(self, new_city):
    if new_city == 'Plovdiv':
        raise ValueError()
    self.__city = new_city
```
* гетъра и сетъра са методи с еднакви имена, различават се само
по декоратора
# 3 Скрити методи (Private methods)
* в други езици терминът е private, не hidden
* hidden означава че могат да се достъпват само вътре в класа
* скритите методи и propertita, и дейта атрибути не можем да 
достъпваме отвън
* методи и полета
* методите ги правим hidden, за полетата имаме енкапсулация 
  (т.е. ги правим на property)
* стандартът е да се използват гетъри и сетъри за да се енкапсулира поле
вместо да се задават с __ в инит
* name mangling - действие; смяната на името на прайвит атрибути / полета
; погрозняване



